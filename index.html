<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOAL GUIDE</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  
  /* --- Background ပိုင်းကိုသာ ပြင်ဆင်ထားပြီး ကျန်တာအားလုံး မူလအတိုင်းဖြစ်သည် --- */
  body {
    font-family: Inter, sans-serif;
    background-color: #0b0f14;
    background-image: linear-gradient(rgba(11, 15, 20, 0.85), rgba(11, 15, 20, 0.85)), 
                      url('https://www.transparenttextures.com/patterns/football-no-fill.png'); 
    background-size: 380px;
    background-attachment: fixed;
    color: #fff;
  }
  
  /* --- Header ပိုင်းနှင့် Refresh Button ပြင်ဆင်မှု --- */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between; /* ညာဘက်မှာ Refresh Button ထားရန် */
    padding: 12px 16px;
    background: #111827;
    position: sticky;
    top: 0;
    z-index: 1050;
    border-bottom: 2px solid #facc15;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
  }
  .header-left { display: flex; align-items: center; gap: 12px; }
  
  .logo-img {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    border: 1px solid #facc15;
    transition: transform 0.3s ease;
    cursor: pointer;
  }
  .logo-img:hover { transform: scale(1.1); }
  .logo-text { font-weight: 800; color: #facc15; font-size: 20px; }

  /* Refresh Button Style */
  .refresh-btn {
    background: #1f2937;
    border: 1px solid #facc15;
    color: #facc15;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .refresh-btn:hover {
    background: #facc15;
    color: #111827;
    transform: scale(1.05);
  }
  .refresh-btn:active { transform: scale(0.95); }

  /* --- Navigation Tabs --- */
  .nav-tabs {
    display: flex;
    background: #111827;
    padding: 12px 16px;
    gap: 12px;
    position: sticky;
    top: 66px;
    z-index: 1040;
    border-bottom: 1px solid #1f2937;
    overflow-x: auto;
    scrollbar-width: none;
  }
  .nav-tabs::-webkit-scrollbar { display: none; }

  .tab-btn {
    padding: 10px 18px;
    background: #1f2937;
    border: 1px solid #30363d;
    color: #8b949e;
    font-weight: 700;
    font-size: 12px;
    border-radius: 8px;
    cursor: pointer;
    text-transform: uppercase;
    white-space: nowrap;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  .tab-btn:hover {
    color: #fff;
    background: #2d333b;
    border-color: #facc15;
    transform: translateY(-4px);
    box-shadow: 0 5px 12px rgba(250, 204, 21, 0.2);
  }
  .tab-btn.active {
    background: #facc15;
    color: #111827;
    border-color: #facc15;
    transform: scale(1.05);
  }

  .content-section{display:none;}
  .content-section.active{display:block;}

  .date-bar{display:flex;justify-content:center;align-items:center;gap:10px;padding:15px;}
  .date-bar button, .date-bar input{background:#1f2937;border:none;color:#fff;padding:8px;border-radius:8px;}
  
  .league-card{margin:12px;background:#151a21;border-radius:12px;border: 2px solid #facc15;overflow:hidden;box-shadow: 0 4px 15px rgba(250, 204, 21, 0.1);}
  .league-header{padding:10px 14px;font-size:12px;font-weight:700;background:#1b2230;color:#8b949e;display:flex;align-items:center;gap:10px;}
  .league-header img{width:20px;height:20px;}

  .match {
    display:grid;
    grid-template-columns:95px 1fr 65px 1fr;
    align-items:center;
    padding:16px 14px;
    border-top:1px solid #30363d;
    transition: all 0.3s;
    cursor: pointer;
    background: #151a21;
  }
  .match:hover {background: #1c232d;}

  .time-status{font-size: 13px; font-weight: 800; color: #8b949e;}
  .status-pp{color:#ef4444; font-weight: 800;}
  .score-pp{text-decoration: line-through; color: #4b5563 !important;}
  .status-live{color:#ef4444;animation:blink 1.5s infinite;}
  @keyframes blink{0%{opacity:1}50%{opacity:0.4}100%{opacity:1}}
  
  .team-row{display:flex;flex-direction:column;align-items:center;gap:6px;}
  .team-row img{width:30px;height:30px;object-fit:contain;background:#fff;border-radius:4px;padding:2px;}
  .score-box{font-size:18px;font-weight:800;text-align:center;color:#facc15;}

  /* --- Lineup UI Style --- */
  .lineup-header { display:flex; justify-content: space-between; align-items: center; padding: 15px; background: #1a1f26; border-bottom: 1px solid #30363d;}
  .team-info { display: flex; align-items: center; gap: 8px; font-weight: 700; font-size: 14px;}
  .formation-label { font-size: 12px; color: #8b949e; margin-left: 5px;}
  
  .pitch-container {
    background: #151a21;
    position: relative;
    padding: 20px 10px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    min-height: 450px;
    background-image: radial-gradient(circle at center, #1f2937 1px, transparent 1px);
    background-size: 20px 20px;
  }
  .pitch-divider { position: absolute; left: 50%; top: 10%; bottom: 10%; border-left: 1px solid rgba(255,255,255,0.1); }

  .player-node { display: flex; flex-direction: column; align-items: center; gap: 4px; margin-bottom: 15px;}
  .player-img { width: 35px; height: 35px; border-radius: 50%; background: #2d333b; border: 1px solid #facc15; object-fit: cover;}
  .player-name { font-size: 10px; font-weight: 600; text-align: center; color: #fff;}
  .player-num { font-size: 9px; color: #8b949e; margin-right: 2px;}

  .grid-layout{display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:20px;padding:16px;}
  .video-card { background: #151a21; border-radius: 12px; overflow: hidden; border: 2px solid #30363d; cursor: pointer; transition: 0.3s;}
  .video-card:hover { border-color: #facc15; transform: translateY(-5px);}
  .video-card img{width:100%; aspect-ratio:16/9; object-fit:cover;}
  .video-card .title-box {padding:12px; font-weight:600; font-size:13px;}

  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);align-items:center;justify-content:center;z-index:2000;}
  .modal-content{width:95%;max-width:800px;background:#0b0f14;border-radius:15px;overflow:hidden; border: 1px solid #30363d;}
  .close-modal{position:absolute;top:10px;right:15px;color:#fff;font-size:35px;cursor:pointer;z-index:2001;}

  footer{text-align:center;padding:30px;color:#6b7280;font-size:11px;}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="IMG_20260123_104505_958.jpg" class="logo-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'">
    <div class="logo-text">GOAL GUIDE</div>
  </div>
  <button class="refresh-btn" onclick="location.reload()">
    <span>↻</span> Refresh
  </button>
</header>

<nav class="nav-tabs">
  <button id="tab-matches" class="tab-btn active" onclick="switchTab('matches')">Matches</button>
  <button id="tab-live" class="tab-btn" onclick="switchTab('live')">Live Streaming</button>
  <button id="tab-standings" class="tab-btn" onclick="switchTab('standings')">Standings</button>
  <button id="tab-highlights" class="tab-btn" onclick="switchTab('highlights')">Highlights</button>
</nav>

<div id="section-matches" class="content-section active">
  <div class="date-bar">
    <button onclick="changeDate(-1)">◀</button>
    <input type="date" id="matchDate" onchange="handleDateChange(this.value)">
    <button onclick="changeDate(1)">▶</button>
  </div>
  <div id="matches-list"></div>
</div>

<div id="section-live" class="content-section"><div id="live-list" class="grid-layout"></div></div>
<div id="section-standings" class="content-section"><div id="standings-list"></div></div>
<div id="section-highlights" class="content-section"><div id="highlights-list" class="grid-layout"></div></div>

<div id="mainModal" class="modal" onclick="closeModal()">
  <span class="close-modal" onclick="closeModal()">&times;</span>
  <div class="modal-content" onclick="event.stopPropagation()">
    <div id="modalBody"></div>
  </div>
</div>

<footer>GOAL GUIDE © 2026</footer>

<script>
const API_BASE = "https://goalguide-api-1.onrender.com";
let selectedDate = new Date().toLocaleDateString('en-CA');
document.getElementById("matchDate").value = selectedDate;

function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  document.getElementById('section-' + tab).classList.add('active');
  if(tab === 'matches') loadMatches();
  if(tab === 'live') loadLive();
  if(tab === 'standings') loadStandings();
  if(tab === 'highlights') loadHighlights();
}

async function loadMatches() {
    const list = document.getElementById("matches-list");
    list.innerHTML = "<p style='text-align:center;padding:40px;'>ပွဲစဉ်များ ဆွဲယူနေပါသည်...</p>";

    try {
        const response = await fetch(`${API_BASE}/api/fixtures/date/${selectedDate}`);
        const result = await response.json();

        // Backend က data ပုံစံပေါ်မူတည်ပြီး data ထုတ်ယူခြင်း (result.data သို့မဟုတ် result)
        const events = result.data || result;

        if (!events || events.length === 0) {
            list.innerHTML = "<p style='text-align:center;padding:40px;'>ယနေ့အတွက် ပွဲစဉ်များ မရှိပါ။</p>";
            return;
        }

        const grouped = events.reduce((acc, ev) => {
            const l = ev.league?.name || "Other League";
            if (!acc[l]) acc[l] = { matches: [] };
            acc[l].matches.push(ev);
            return acc;
        }, {});

        let html = "";
        for (let l in grouped) {
            html += `<div class="league-card">
                        <div class="league-header">
                            <img src="https://cdn-icons-png.flaticon.com/512/53/53283.png" width="20" height="20">
                            ${l}
                        </div>`;
            
            grouped[l].matches.forEach(m => {
                const status = m.state?.description || "TBA";
                const homeTeam = m.participants.find(p => p.meta.location === 'home');
                const awayTeam = m.participants.find(p => p.meta.location === 'away');
                
                const homeScore = m.scores?.find(s => s.description === 'CURRENT' && s.participant_id === homeTeam.id)?.score?.goals ?? 0;
                const awayScore = m.scores?.find(s => s.description === 'CURRENT' && s.participant_id === awayTeam.id)?.score?.goals ?? 0;
                
                let matchTime = "TBA";
                if(m.starting_at) {
                   const dateObj = new Date(m.starting_at);
                   matchTime = dateObj.getHours().toString().padStart(2, '0') + ":" + dateObj.getMinutes().toString().padStart(2, '0');
                }

                let centerDisplay = `<div class="score-box">${homeScore} - ${awayScore}</div>`;
                let statusHtml = `<span>${status}</span>`;

                if (status.toLowerCase().includes("pending") || status.toLowerCase().includes("not started")) {
                    centerDisplay = `<div class="score-box" style="font-size:14px; color:#8b949e;">VS</div>`;
                    statusHtml = `<span>${matchTime}</span>`;
                } else if (status.toLowerCase().includes("live")) {
                    statusHtml = `<span class="status-live">● LIVE</span>`;
                }

                // Logo link ကို Sportmonks ရဲ့ image_path အတိုင်း ပြန်သုံးထားပါတယ်
                const hLogo = homeTeam.image_path || `https://api.sofascore.app/api/v1/team/${homeTeam.id}/image`;
                const aLogo = awayTeam.image_path || `https://api.sofascore.app/api/v1/team/${awayTeam.id}/image`;

                html += `
                <div class="match" onclick="showLineup(${m.id}, '${homeTeam.name.replace(/'/g, "\\'")}', '${awayTeam.name.replace(/'/g, "\\'")}')">
                    <div class="time-status">${statusHtml}</div>
                    <div class="team-row">
                        <img src="${hLogo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">
                        <span>${homeTeam.name}</span>
                    </div>
                    ${centerDisplay}
                    <div class="team-row">
                        <img src="${aLogo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">
                        <span>${awayTeam.name}</span>
                    </div>
                </div>`;
            });
            html += `</div>`;
        }
        list.innerHTML = html;
    } catch (e) {
        list.innerHTML = "<p style='text-align:center;padding:40px;'>Error: ဒေတာယူ၍မရပါ။</p>";
    }
}

async function showLineup(id, home, away) {
  const modal = document.getElementById("mainModal");
  const body = document.getElementById("modalBody");
  modal.style.display = "flex";
  body.innerHTML = "<p style='text-align:center;padding:50px;'>Loading Lineup...</p>";

  try {
    const res = await fetch(`${API_BASE}/api/fixtures/${id}`);
    const result = await res.json();
    const data = result.data || result;

    if (!data || !data.lineups || data.lineups.length === 0) {
        body.innerHTML = `<div style='padding:40px;text-align:center;'>Lineup Not Available for this match yet.</div>`;
        return;
    }
    const homeId = data.participants[0].id;
    const awayId = data.participants[1].id;
    const homeLineup = data.lineups.filter(l => l.team_id === homeId);
    const awayLineup = data.lineups.filter(l => l.team_id === awayId);

    let html = `
      <div class="lineup-header">
        <div class="team-info">${home} <span class="formation-label">${data.formations?.[0] || ''}</span></div>
        <div style="font-weight:800; font-size:12px; color:#facc15;">Lineup</div>
        <div class="team-info"><span class="formation-label">${data.formations?.[1] || ''}</span> ${away}</div>
      </div>
      <div class="pitch-container">
        <div class="pitch-divider"></div>
        <div class="home-side" style="display:flex; flex-wrap:wrap; justify-content:center; align-content:center; gap:10px;">
           ${homeLineup.map(p => `
             <div class="player-node">
               <img class="player-img" src="${p.player?.image_path || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">
               <div class="player-name"><span class="player-num">${p.number || ''}</span>${p.player?.name || 'Unknown'}</div>
             </div>
           `).join('')}
        </div>
        <div class="away-side" style="display:flex; flex-wrap:wrap; justify-content:center; align-content:center; gap:10px;">
           ${awayLineup.map(p => `
             <div class="player-node">
               <img class="player-img" src="${p.player?.image_path || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">
               <div class="player-name"><span class="player-num">${p.number || ''}</span>${p.player?.name || 'Unknown'}</div>
             </div>
           `).join('')}
        </div>
      </div>`;
    body.innerHTML = html;
  } catch(e) { body.innerHTML = "<div style='padding:40px;text-align:center;'>Lineup Not Available.</div>"; }
}

async function loadStandings() {
  const list = document.getElementById("standings-list");
  list.innerHTML = "<p style='text-align:center;padding:40px;'>Standings ဆွဲယူနေပါသည်...</p>";
  try {
    const res = await fetch(`${API_BASE}/api/standings`);
    const result = await res.json();
    const data = result.data || result;

    if(!data || data.length === 0) { list.innerHTML = "Unavailable"; return; }
    
    list.innerHTML = data.map(l => `
      <div class="league-card">
        <div class="league-header">${l.league?.name || 'League'}</div>
        <div style="overflow-x:auto; padding:10px;">
          <table style="width:100%; border-collapse:collapse; font-size:12px;">
            <tr style="color:#8b949e; text-align:left;"><th>#</th><th>Team</th><th>PL</th><th>PTS</th></tr>
            ${l.standings?.map(s => `
              <tr style="border-top:1px solid #30363d;">
                <td style="padding:8px 0;">${s.position}</td>
                <td>${s.participant?.name}</td>
                <td>${s.details?.find(d => d.type_id === 129)?.value || 0}</td>
                <td style="color:#facc15; font-weight:800;">${s.points}</td>
              </tr>
            `).join('')}
          </table>
        </div>
      </div>`).join('');
  } catch(e) { list.innerHTML = "Unavailable"; }
}

async function loadLive() {
  const list = document.getElementById("live-list");
  list.innerHTML = "<p style='text-align:center;width:100%;padding:40px;'>Live ပွဲစဉ်များ ရှာဖွေနေပါသည်...</p>";

  let html = "";
  let hasContent = false;

  try {
    try {
      const JSON_URL = "https://raw.githubusercontent.com/goalguide-mm/goalguide-api/main/live.json"; 
      const res = await fetch(JSON_URL, { cache: "no-store" });
      if (res.ok) {
        const manualData = await res.json();
        if (Array.isArray(manualData) && manualData.length > 0) {
          manualData.forEach(item => {
            if (item.url && item.url.includes("http")) {
              hasContent = true;
              html += `
                <div class="video-card" onclick="openPlayer('${item.url}')">
                  <div style="position:relative;">
                    <img src="${item.img}" onerror="this.src='https://via.placeholder.com/300x170?text=Live+Match'">
                    <span style="position:absolute; top:10px; left:10px; background:#facc15; color:#000; padding:2px 8px; border-radius:4px; font-size:10px; font-weight:bold;">MYANMAR LIVE</span>
                  </div>
                  <div class="title-box">${item.title}</div>
                </div>`;
            }
          });
        }
      }
    } catch (manualError) { console.log("Manual JSON error bypassed."); }

    try {
      const TOKEN = "MTc5MDU0XzE3Mzg5MTM1ODZfNGU5YjA3ZGE1YjU1MmFkYjQ5ZTkzZjc0N2U2YmFmYjBkYmNmMDdhYg==";
      const scoreBatRes = await fetch(`https://www.scorebat.com/video-api/v3/feed/?token=${TOKEN}`);
      
      if (scoreBatRes.ok) {
        const sbData = await scoreBatRes.json();
        if (sbData && sbData.response) {
          const autoLive = sbData.response.filter(m => 
            m.videos && m.videos.some(v => v.title.toLowerCase().includes('live'))
          );

          autoLive.forEach(item => {
            hasContent = true;
            html += `
              <div class="video-card" onclick="openPlayer('${item.matchviewUrl}')">
                <div style="position:relative;">
                  <img src="${item.thumbnail}" onerror="this.src='https://via.placeholder.com/300x170?text=Live+Match'">
                  <span style="position:absolute; top:10px; left:10px; background:red; color:white; padding:2px 8px; border-radius:4px; font-size:10px; font-weight:bold; animation:blink 1.5s infinite;">LIVE</span>
                </div>
                <div class="title-box">
                  <div style="color:#facc15; font-size:11px; margin-bottom:4px;">${item.competition}</div>
                  ${item.title}
                </div>
              </div>`;
          });
        }
      }
    } catch (sbError) { console.log("ScoreBat API error bypassed."); }

    if (!hasContent) {
      list.innerHTML = "<p style='text-align:center;width:100%;padding:40px;'>လောလောဆယ် Live ပြနေသည့် ပွဲစဉ်မရှိသေးပါ။</p>";
    } else {
      list.innerHTML = html;
    }

  } catch (globalError) {
    list.innerHTML = "<p style='text-align:center;width:100%;padding:40px;'>လောလောဆယ် Live ပြနေသည့် ပွဲစဉ်မရှိသေးပါ။</p>";
  }
}

async function loadHighlights() {
  const list = document.getElementById("highlights-list");
  try {
    const res = await fetch(`${API_BASE}/api/highlights`);
    const data = await res.json();
    list.innerHTML = data.map(h => `<div class="video-card" onclick="openVideo('${h.matchviewUrl}')"><img src="${h.thumbnail}"><div class="title-box">${h.title}</div></div>`).join('');
  } catch(e) { list.innerHTML = "Error"; }
}

function openVideo(url) {
  document.getElementById("mainModal").style.display = "flex";
  document.getElementById("modalBody").innerHTML = `<iframe src="${url}" style="width:100%;aspect-ratio:16/9;border:none;" allowfullscreen></iframe>`;
}

function openPlayer(url) {
  document.getElementById("mainModal").style.display = "flex";
  document.getElementById("modalBody").innerHTML = `
    <div style="position:relative; padding-bottom:56.25%; height:0; overflow:hidden; background:#000;">
      <iframe src="${url}" 
        style="position:absolute; top:0; left:0; width:100%; height:100%; border:none;" 
        allowfullscreen allow='autoplay; fullscreen'>
      </iframe>
    </div>`;
}

function closeModal() { document.getElementById("mainModal").style.display = "none"; document.getElementById("modalBody").innerHTML = ""; }
function handleDateChange(v) { selectedDate = v; loadMatches(); }
function changeDate(n) { let d = new Date(selectedDate); d.setDate(d.getDate()+n); selectedDate = d.toLocaleDateString('en-CA'); document.getElementById("matchDate").value = selectedDate; loadMatches(); }

loadMatches();
</script>
</body>
</html>
