<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOAL GUIDE | Football Scores</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  /* Modern Style */
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,sans-serif;background:#0b0f14;color:#fff;}
  
  header{
    display:flex;
    align-items:center;
    padding:12px 16px;
    background:#111827;
    position: sticky;
    top: 0;
    z-index: 100;
    gap: 12px;
  }
  .logo-img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }
  .logo-text { font-weight: 800; color: #facc15; font-size: 20px; }

  .date-bar{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
    padding:15px;
    background:#0b0f14;
  }
  .date-bar button{
    background:#1f2937;
    border:none;
    color:#fff;
    width:35px;
    height:35px;
    border-radius:10px;
    cursor:pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .date-bar input[type="date"] {
    background: #1f2937;
    border: none;
    color: #fff;
    padding: 8px 12px;
    border-radius: 8px;
    font-family: inherit;
    font-weight: 600;
    outline: none;
  }

  .league{
    margin:0 12px 16px 12px;
    background:#151a21;
    border-radius:12px;
    border: 1px solid #30363d;
    overflow:hidden;
  }
  .league-header{
    padding:10px 14px;
    font-size:12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight:700;
    background:#1b2230;
    color: #8b949e;
    display: flex;
    align-items: center;
  }
  
  .match{
    display:grid;
    grid-template-columns: 80px 1fr 50px 1fr;
    align-items:center;
    padding:16px 14px;
    border-top:1px solid #222833;
  }

  .time-status{ font-size:14px; color:#fff; font-weight: 800; }
  .live-dot { color: #ef4444; animation: blink 1.5s infinite; }
  @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.4;} 100% {opacity: 1;} }

  .team{ display:flex; flex-direction: column; align-items:center; gap:8px; text-align: center; }
  .team img{ width:32px; height:32px; object-fit: contain; }
  .team span{ font-size: 13px; font-weight: 500; }

  .score-box{ font-size: 18px; font-weight:800; text-align: center; color: #facc15; }
  footer{text-align:center;padding:30px;color:#6b7280;font-size:12px;}
</style>
</head>
<body>

<header>
  <img src="IMG_20260123_104505_958.jpg" alt="Logo" class="logo-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'">
  <div class="logo-text">GOAL GUIDE</div>
</header>

<div class="date-bar">
  <button onclick="changeDate(-1)">◀</button>
  <input type="date" id="matchDate" onchange="handleDateChange(this.value)">
  <button onclick="changeDate(1)">▶</button>
</div>

<div id="matches"></div>

<footer>GOAL GUIDE © 2026</footer>

<script>
const API_BASE = "https://goalguide-api-1.onrender.com";
const matchesEl = document.getElementById("matches");
const dateInput = document.getElementById("matchDate");

let selectedDate = new Date().toISOString().split('T')[0];
dateInput.value = selectedDate;

function handleDateChange(date) {
  selectedDate = date;
  loadMatches();
}

function changeDate(days) {
  let d = new Date(selectedDate);
  d.setDate(d.getDate() + days);
  selectedDate = d.toISOString().split('T')[0];
  dateInput.value = selectedDate;
  loadMatches();
}

async function loadMatches() {
  matchesEl.innerHTML = "<p style='padding:40px; text-align:center; color:#8b949e;'>Fetching matches...</p>";
  try {
    const res = await fetch(`${API_BASE}/api/fixtures/date/${selectedDate}`);
    const data = await res.json();
    renderMatches(data);
  } catch (e) {
    matchesEl.innerHTML = "<p style='padding:40px; text-align:center; color:#ef4444;'>Server is starting... Please wait 30s.</p>";
  }
}

// Logo URL များကို HTTPS ပြောင်းပေးရန်
const fixUrl = (url) => {
    if (!url) return 'https://cdn-icons-png.flaticon.com/512/53/53234.png';
    return url.replace('http://', 'https://');
};

function renderMatches(matches) {
  if (!matches || !matches.length) {
    matchesEl.innerHTML = "<p style='padding:50px; text-align:center; color:#8b949e;'>No matches found.</p>";
    return;
  }

  // အချိန်အလိုက် စီခြင်း
  matches.sort((a, b) => new Date(a.starting_at) - new Date(b.starting_at));

  // လိဂ်အလိုက် အုပ်စုဖွဲ့ခြင်း
  const grouped = matches.reduce((acc, m) => {
    const lName = m.league?.name || "Other Leagues";
    if (!acc[lName]) acc[lName] = [];
    acc[lName].push(m);
    return acc;
  }, {});

  let html = "";
  for (const lName in grouped) {
    const lLogo = grouped[lName][0].league?.image_path;
    
    html += `
      <section class="league">
        <div class="league-header">
          <img src="${fixUrl(lLogo)}" style="width:18px; height:18px; margin-right:8px; border-radius:2px;" onerror="this.style.display='none'">
          ${lName}
        </div>
    `;

    grouped[lName].forEach(m => {
      const homeTeam = m.participants?.find(p => p.meta?.location === 'home');
      const awayTeam = m.participants?.find(p => p.meta?.location === 'away');
      const isLive = m.state && ["INPLAY", "HT", "LIVE"].includes(m.state.state);
      const mTime = m.starting_at ? new Date(m.starting_at).toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit', hour12: true}) : "TBD";

      // ဂိုးရလဒ် Logic အမှန်
      const hScoreObj = m.scores?.find(s => s.description === "CURRENT" && s.participant_id === homeTeam?.id);
      const aScoreObj = m.scores?.find(s => s.description === "CURRENT" && s.participant_id === awayTeam?.id);
      const hScore = hScoreObj ? hScoreObj.score.goals : 0;
      const aScore = aScoreObj ? aScoreObj.score.goals : 0;
      const displayScore = (m.state?.state === "NS") ? "vs" : `${hScore} - ${aScore}`;

      html += `
        <div class="match">
          <div class="time-status">${isLive ? '<span class="live-dot">● LIVE</span>' : mTime}</div>
          <div class="team">
            <img src="${fixUrl(homeTeam?.image_path)}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53234.png'">
            <span>${homeTeam?.name || 'TBD'}</span>
          </div>
          <div class="score-box">${displayScore}</div>
          <div class="team">
            <img src="${fixUrl(awayTeam?.image_path)}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53234.png'">
            <span>${awayTeam?.name || 'TBD'}</span>
          </div>
        </div>
      `;
    });
    html += `</section>`;
  }
  matchesEl.innerHTML = html;
}

loadMatches();
</script>
</body>
</html>
