<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<title>GOAL GUIDE</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  /* မင်းရဲ့ မူလ Style တွေကို ဒီမှာ ဆက်ထားပါ (မပြောင်းလဲပါ) */
  * { box-sizing: border-box; margin: 0; padding: 0; font-weight: 700; }
  body {
    font-family: 'Inter', sans-serif;
    background-color: #0b0f14;
    background-image: linear-gradient(rgba(11, 15, 20, 0.7), rgba(11, 15, 20, 0.85)), 
                      url('https://images.unsplash.com/photo-1508098682722-e99c43a406b2?q=80&w=1920&auto=format&fit=crop'); 
    background-size: cover; background-position: center; background-attachment: fixed;
    color: #fff; height: 100vh; overflow: hidden; position: relative; border: 5px solid #facc15; 
  }
  header {
    display: flex; align-items: center; justify-content: space-between; padding: 12px 20px;
    background: rgba(17, 24, 39, 0.95); backdrop-filter: blur(10px); position: fixed;
    top: 0; left: 0; right: 0; height: 70px; z-index: 1050; border-bottom: 2px solid #facc15;
  }
  .logo-img { height: 45px; border-radius: 50%; border: 2px solid #facc15; }
  .logo-text { color: #facc15; font-size: 24px; font-weight: 800; }
  .controls-wrapper { display: flex; background: #1a1d23; padding: 10px 20px; max-width: 600px; margin: 85px auto 15px; border-radius: 30px; border: 1px solid #facc15; }
  #teamSearch { flex: 1; background: transparent; border: none; color: #fff; outline: none; }
  .content-section { display: none; position: absolute; top: 70px; bottom: 75px; left: 0; right: 0; overflow-y: auto; padding: 10px; }
  .content-section.active { display: block; }
  .league-card { background: #1a1d23; border: 1.5px solid #facc15; border-radius: 8px; margin-bottom: 15px; overflow: hidden; }
  .match { display: grid; grid-template-columns: 1fr 100px 1fr; align-items: center; padding: 15px; cursor: pointer; }
  .score-box { color: #facc15; font-weight: 900; text-align: center; }
  .status-live { color: #ff4d4d; animation: blink 1s infinite; }
  @keyframes blink { 50% { opacity: 0.5; } }
  .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: #111827; display: flex; justify-content: space-around; align-items: center; border-top: 2px solid #facc15; }
  .nav-item span { font-size: 11px; padding: 8px 12px; border: 2px solid #facc15; border-radius: 8px; background: #1f2937; color: #fff; }
  .nav-item.active span { background: rgba(250, 204, 21, 0.3); color: #facc15; }
  .standings-table { width: 100%; border-collapse: collapse; background: #1a1d23; border: 1.5px solid #facc15; }
  .standings-table th, .standings-table td { padding: 10px; border: 1px solid rgba(250, 204, 21, 0.1); text-align: center; }
  .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 3000; align-items: center; justify-content: center; }
  .modal-content { width: 95%; max-width: 800px; background: #0b0f14; border: 2px solid #facc15; border-radius: 12px; }
</style>
</head>
<body>

<header>
  <div class="logo-wrapper" onclick="location.reload()">
    <img src="./IMG_20260123_104505_958.jpg" alt="Logo" class="logo-img">
    <div class="logo-text">GOAL GUIDE</div>
  </div>
  <button class="refresh-btn" onclick="location.reload()">REFRESH</button>
</header>

<div id="section-matches" class="content-section active">
  <div class="controls-wrapper">
    <input type="text" id="teamSearch" placeholder="Search team..." oninput="filterBySearch(this.value)">
  </div>
  <div id="matches-list"></div>
</div>

<div id="section-live" class="content-section">
  <div id="live-list" style="max-width: 600px; margin: 20px auto;"></div>
</div>

<div id="section-standings" class="content-section">
  <div id="standings-list" class="standings-container"></div>
</div>

<div id="section-highlights" class="content-section">
  <div id="highlights-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; padding: 10px;"></div>
</div>

<div class="bottom-nav">
  <div class="nav-item active" id="nav-matches" onclick="switchTab('matches')"><span>MATCHES</span></div>
  <div class="nav-item" id="nav-live" onclick="switchTab('live')"><span>LIVE</span></div>
  <div class="nav-item" id="nav-standings" onclick="switchTab('standings')"><span>TABLE</span></div>
  <div class="nav-item" id="nav-highlights" onclick="switchTab('highlights')"><span>GOALS</span></div>
</div>

<div id="mainModal" class="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div id="modalBody"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
const SCRAPER_API_URL = "https://live-stream-api-1.onrender.com/get-live";
const RENDER_BASE_URL = "https://live-stream-api-1.onrender.com";
let allMatchesData = [];

function switchTab(tab) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
  document.getElementById('nav-' + tab).classList.add('active');
  document.getElementById('section-' + tab).classList.add('active');
  
  if(tab === 'matches') loadMatches();
  if(tab === 'standings') loadStandings("premier-league"); 
  if(tab === 'highlights') loadHighlights();
  if(tab === 'live') loadLive();
}

async function loadMatches() {
    const list = document.getElementById("matches-list");
    list.innerHTML = "<p style='text-align:center;padding:40px;color:#facc15;'>Fetching Streams...</p>";
    try {
        const response = await fetch(SCRAPER_API_URL);
        const result = await response.json(); 
        if (Array.isArray(result) && result.length > 0) {
            allMatchesData = result;
            renderMatches(result);
        } else {
            list.innerHTML = '<p style="text-align:center;padding:40px;">No active matches found.</p>';
        }
    } catch (error) {
        list.innerHTML = '<p style="text-align:center;padding:40px;color:red;">API Connection Error.</p>';
    }
}

function renderMatches(matches) {
    const list = document.getElementById("matches-list");
    list.innerHTML = matches.map(m => `
        <div class="league-card">
            <div class="match" onclick="window.open('${m.url}', '_blank')">
                <div style="text-align:right;">${m.source.split('/')[2] || 'Live'}</div>
                <div class="score-section">
                    <div class="score-box status-live">LIVE</div>
                </div>
                <div>GOAL GUIDE TV</div>
            </div>
            <div style="padding:10px; font-size:12px; border-top:1px solid #333;">${m.title}</div>
        </div>
    `).join('');
}

async function loadLive() {
    const list = document.getElementById("live-list");
    list.innerHTML = "<p style='text-align:center;padding:20px;'>Loading Player...</p>";
    try {
        const res = await fetch(SCRAPER_API_URL);
        const data = await res.json();
        if(data[0] && data[0].url) {
            list.innerHTML = `<video id="video-player" controls autoplay style="width:100%; border:2px solid #facc15; border-radius:8px;"></video>`;
            const video = document.getElementById('video-player');
            if (Hls.isSupported()) {
                const hls = new Hls(); hls.loadSource(data[0].url); hls.attachMedia(video);
            } else { video.src = data[0].url; }
        }
    } catch(e) { list.innerHTML = "Error loading live stream."; }
}

async function loadStandings(league) {
    const list = document.getElementById("standings-list");
    list.innerHTML = "<p style='text-align:center;padding:20px;'>Loading Table...</p>";
    try {
        // Render API မှာ /api/standings route ရှိဖို့လိုပါတယ်
        const res = await fetch(`${RENDER_BASE_URL}/api/standings/${league}`);
        const data = await res.json();
        list.innerHTML = `
            <table class="standings-table">
                <thead><tr><th>#</th><th>Team</th><th>PTS</th></tr></thead>
                <tbody>${data.map(r => `<tr><td>${r.rank}</td><td>${r.team.name}</td><td>${r.points}</td></tr>`).join('')}</tbody>
            </table>`;
    } catch(e) { list.innerHTML = "<p style='text-align:center;'>Table Data Error.</p>"; }
}

async function loadHighlights() {
    const list = document.getElementById("highlights-list");
    try {
        const res = await fetch(`https://rapid-cell-5054.pmk818299.workers.dev/highlights`);
        const data = await res.json();
        list.innerHTML = data.map(h => `
            <div class="league-card" onclick="openVideo('${h.url}')">
                <img src="${h.thumbnail}" style="width:100%;">
                <p style="font-size:10px; padding:5px;">${h.title}</p>
            </div>
        `).join('');
    } catch(e) { list.innerHTML = "Error."; }
}

function openVideo(url) {
    document.getElementById("mainModal").style.display = "flex";
    document.getElementById("modalBody").innerHTML = `<iframe src="${url}" style="width:100%; height:300px; border:none;" allowfullscreen></iframe>`;
}

function closeModal() { document.getElementById("mainModal").style.display = "none"; }
function filterBySearch(val) {
    const filtered = allMatchesData.filter(m => m.title.toLowerCase().includes(val.toLowerCase()));
    renderMatches(filtered);
}

window.onload = loadMatches;
</script>
</body>
</html>
