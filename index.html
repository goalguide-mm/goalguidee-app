<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOAL GUIDE | Football Scores</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  /* Modern FotMob Style */
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,sans-serif;background:#0b0f14;color:#fff;}
  
  header{
    display:flex;
    align-items:center;
    padding:12px 16px;
    background:#111827;
    position: sticky;
    top: 0;
    z-index: 100;
    gap: 12px; /* Logo နဲ့ စာသားကြား အကွာအဝေး */
  }
  /* Logo ပုံအတွက် Style */
  .logo-img {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    object-fit: cover;
  }
  .logo-text {
    font-weight: 800;
    color: #facc15;
    font-size: 20px;
  }

  /* Date Bar Styling */
  .date-bar{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
    padding:15px;
    background:#0b0f14;
  }
  .date-bar button{
    background:#1f2937;
    border:none;
    color:#fff;
    width:35px;
    height:35px;
    border-radius:10px;
    cursor:pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .date-bar input[type="date"] {
    background: #1f2937;
    border: none;
    color: #fff;
    padding: 8px 12px;
    border-radius: 8px;
    font-family: inherit;
    font-weight: 600;
    outline: none;
  }

  /* Match Cards */
  .league{
    margin:0 12px 16px 12px;
    background:#151a21;
    border-radius:12px;
    border: 1px solid #30363d;
    overflow:hidden;
  }
  .league-header{
    padding:10px 14px;
    font-size:12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight:700;
    background:#1b2230;
    color: #8b949e;
  }
  
  .match{
    display:grid;
    grid-template-columns: 80px 1fr 50px 1fr; /* အချိန်နေရာကို နည်းနည်းပိုချဲ့ထားသည် */
    align-items:center;
    padding:16px 14px;
    border-top:1px solid #222833;
  }

  .time-status{
    font-size:14px; /* အချိန် Font ကို ပိုကြီးထားသည် */
    color:#fff;
    font-weight: 800;
  }
  .live-dot {
    color: #ef4444;
    font-weight: 800;
    animation: blink 1.5s infinite;
  }
  @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.4;} 100% {opacity: 1;} }

  .team{
    display:flex;
    flex-direction: column;
    align-items:center;
    gap:8px;
    text-align: center;
  }
  .team img{ width:32px; height:32px; object-fit: contain; }
  .team span{ font-size: 13px; font-weight: 500; }

  .score-box{
    font-size: 18px;
    font-weight:800;
    text-align: center;
    color: #facc15;
  }

  footer{text-align:center;padding:30px;color:#6b7280;font-size:12px;}
</style>
</head>

<body>

<header>
  <img src="IMG_20260123_104505_958.jpg" alt="Logo" class="logo-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'">
  <div class="logo-text">GOAL GUIDE</div>
</header>

<div class="date-bar" id="dateBarContainer">
  <button onclick="changeDate(-1)">◀</button>
  <input type="date" id="matchDate" onchange="handleDateChange(this.value)">
  <button onclick="changeDate(1)">▶</button>
</div>

<div id="matches"></div>

<footer>GOAL GUIDE © 2026</footer>

<script>
const API_BASE = "https://goalguide-api-1.onrender.com";
const matchesEl = document.getElementById("matches");
const dateInput = document.getElementById("matchDate");

let selectedDate = new Date().toISOString().split('T')[0];
dateInput.value = selectedDate;

function handleDateChange(date) {
  selectedDate = date;
  loadMatches();
}

function changeDate(days) {
  let d = new Date(selectedDate);
  d.setDate(d.getDate() + days);
  selectedDate = d.toISOString().split('T')[0];
  dateInput.value = selectedDate;
  loadMatches();
}

async function loadMatches() {
  // ပွဲစဉ်တွေ ရှာနေတုန်းမှာ ပြမယ့်စာသား
  matchesEl.innerHTML = "<p style='padding:40px; text-align:center; color:#8b949e;'>Fetching today's matches...</p>";

  try {
    const res = await fetch(`${API_BASE}/api/today`);
    
    // အကယ်၍ 404 ဖြစ်နေသေးရင် (သို့) server မတက်သေးရင် fixture route ကို ခေတ္တသုံးမည်
    if (!res.ok) {
        const altRes = await fetch(`${API_BASE}/api/fixtures/date/${selectedDate}`);
        const altData = await altRes.json();
        return renderMatches(altData);
    }

    const data = await res.json();
    renderMatches(data);
  } catch (e) {
    // Error ဖြစ်ရင် ပြမည့်စာ
    matchesEl.innerHTML = "<p style='padding:40px; text-align:center; color:#ef4444;'>Connecting to server... Please wait.</p>";
  }
}

function renderMatches(matches) {
  if (!matches || !matches.length) {
    matchesEl.innerHTML = "<p style='padding:50px; text-align:center; color:#8b949e;'>No matches found.</p>";
    return;
  }

  // ၁။ ပွဲစဉ်တွေကို အချိန်အလိုက် အရင်စီပါ (Earliest first)
  matches.sort((a, b) => new Date(a.starting_at) - new Date(b.starting_at));

  // ၂။ ပွဲစဉ်တွေကို League အလိုက် အုပ်စုဖွဲ့ပါ
  const groupedMatches = matches.reduce((acc, match) => {
    const leagueName = match.league?.name || "Other Leagues";
    if (!acc[leagueName]) acc[leagueName] = [];
    acc[leagueName].push(match);
    return acc;
  }, {});

  let html = "";

  // ၃။ အုပ်စုဖွဲ့ထားတဲ့အတိုင်း ပတ်ပြီး HTML ထုတ်ပါ
  for (const leagueName in groupedMatches) {
    const leagueLogo = groupedMatches[leagueName][0].league?.image_path;
    
    html += `
      <section class="league">
        <div class="league-header">
          <img src="${leagueLogo}" style="width:18px; height:18px; vertical-align:middle; margin-right:8px; border-radius:2px;" onerror="this.style.display='none'">
          ${leagueName}
        </div>
    `;

    groupedMatches[leagueName].forEach(m => {
      const homeTeam = m.participants?.find(p => p.meta?.location === 'home');
      const awayTeam = m.participants?.find(p => p.meta?.location === 'away');
      
      const isLive = m.state && ["INPLAY", "HT", "LIVE"].includes(m.state.state);
      const matchTime = m.starting_at ? new Date(m.starting_at).toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit', hour12: true}) : "TBD";

      const homeScoreObj = m.scores?.find(s => s.description === "CURRENT" && s.participant_id === homeTeam?.id);
      const awayScoreObj = m.scores?.find(s => s.description === "CURRENT" && s.participant_id === awayTeam?.id);

      const homeScore = homeScoreObj ? homeScoreObj.score.goals : 0;
      const awayScore = awayScoreObj ? awayScoreObj.score.goals : 0;
      const displayScore = (m.state?.state === "NS") ? "vs" : `${homeScore} - ${awayScore}`;

      html += `
        <div class="match">
          <div class="time-status">
            ${isLive ? '<span class="live-dot">● LIVE</span>' : matchTime}
          </div>
          <div class="team">
            <img src="${homeTeam?.image_path || ''}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53234.png'">
            <span>${homeTeam?.name || 'TBD'}</span>
          </div>
          <div class="score-box">
            ${displayScore}
          </div>
          <div class="team">
            <img src="${awayTeam?.image_path || ''}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53234.png'">
            <span>${awayTeam?.name || 'TBD'}</span>
          </div>
        </div>
      `;
    });

    html += `</section>`;
  }

  matchesEl.innerHTML = html;
}

loadMatches();
</script>

</body>
</html>
